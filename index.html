<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>poker hands demo</title>
</head>
<body>
    <main>
        <h2>poker hands</h2>
        <input type="number" placeholder="[r]ank count=13" id="r">
        <input type="number" placeholder="[s]uit count=4" id="s">
        <br><samp id="decksize">[d]eck size = 52</samp><br><br>
        <input type="number" placeholder="[h]and size=5" id="h"><br><br>
        <samp id="output"></samp>
    </main>
    <samp id="bg">
        poker hands calculator
    </samp>
    <samp id="author">
        made with pain by zxmushroom63
    </samp>
    
    <style>
        html, body {
            margin: 0;
            padding: 0;
            background-color: rgb(228, 217, 202);
        }
        main {
            height: calc(90vh - 2rem);
            width: calc(90vh - 2rem);
            position: fixed;
            left: calc(50vw - 45vh);
            top: 5vh;
            z-index: 3;
            padding: 1rem;
            border-radius: 5%;
            text-align: center;
            font-family: monospace;
            box-shadow: 4px 4px 12px 0px rgba(0, 0, 0, 0.3), -4px -4px 12px 0px rgba(255, 243, 226, 0.7);
            background-color: rgba(228, 217, 202, 0.7);
            overflow-y: auto;
            overflow-x: hidden;
        }
        #bg {
            position: fixed;
            top: 6px;
            left: 8px;
            line-height: 0.75rem;
            font-size: 0.75rem;
            opacity: 0.2;
            pointer-events: none;
            user-select: none;
            z-index: 0;
        }
        #author {
            position: fixed;
            bottom: 6px;
            right: 8px;
            line-height: 0.75rem;
            font-size: 0.75rem;
            opacity: 0.2;
            pointer-events: none;
            user-select: none;
            z-index: 0;
        }
        input {
            background: transparent;
            border: 0;
            border-left: 2px solid black;
            border-right: 2px solid transparent;
            border-bottom: 1px solid black;
            display: inline-block;
            width: calc(50vh - 2rem);
            outline: transparent;
            caret-shape: underscore;
            caret-color: black;
            margin-bottom: 8px;
            font-family: monospace;
        }
        input:focus {
            border-left: 4px solid black;
            transform: translateX(-1px);
        }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button {
            display: none;
            -webkit-appearance: none;
            appearance: none;
            margin: 0;
        }
        ::-webkit-scrollbar {
            display: none;
            appearance: none;
        }
    </style>
    <script>
        function fact(n) {
            if (!isFinite(n)) {
                throw new Error("factorial function called with undefined or infinite number");
            }
            if (n === 0) {
                return 1;
            } else if (n < 0) {
                throw new Error("factorial function called with subzero input, invalid configuration");
            } else {
                return n * fact(n - 1);
            }
        }
        function perm(n, r) {
            return fact(n) / fact(n - r);
        }
        function comb(n, r) {
            return perm(n, r) / fact(r);
        }
        const definitions = {
            "total": (d, h, s, r, k) => comb(d, h),
            "highcard": (d, h, s, r, k) => (comb(r, h) - k) * (s**h - s),
            "onepair": (d, h, s, r, k) => comb(r, 1) * comb(s, 2) * comb(r - 1, h - 2) * (comb(s, 1)**(h-2)),
            "twopair": (d, h, s, r, k) => comb(r, 2) * (comb(s, 2)**2) * comb(r - 2, h - 4) * (comb(s, 1)**(h-4)),
            "threekind": (d, h, s, r, k) => comb(r, 1) * comb(s, 3) * comb(r - 1, h - 3) * s**(h-3),
            "fullhouse": (d, h, s, r, k) => comb(r, 2) * comb(s, 3) * comb(s, 2) * comb(r - 2, h - 5) * s**(h-5),
            "fourkind": (d, h, s, r, k) => comb(r, 1) * comb(s, 4) * comb(d - 4, 1),
            "royalflush": (d, h, s, r, k) => 1 * comb(h, h) * s,
            "straightflush": (d, h, s, r, k) => (k - 1) * comb(s, 1),
            "straight": (d, h, s, r, k) => k * (s**h) - definitions.straightflush(d, h, s, r, k) - definitions.royalflush(d, h, s, r, k),
            "flush": (d, h, s, r, k) => comb(s, 1) * comb(r, h) - definitions.straightflush(d, h, s, r, k) - definitions.royalflush(d, h, s, r, k),
        }
        const bg = document.querySelector("#bg");
        Object.entries(definitions).forEach(ent => {
            bg.innerText += `\n${ent[0]} = ${ent[1].toString().split("=> ")[1]}`;
        });
        bg.innerText += "\ncompleted in ??";
        let prevSleep = -1;
        function asyncsleep(ms) {
            clearTimeout(prevSleep);
            return new Promise((resolve, reject) => {
                prevSleep = setTimeout(()=>resolve(), ms);
            });
        }
        function assertZahlen(n) {
            n = parseInt(n);
            if (!isFinite(n)) {
                throw new Error("input number is infinite, complex or invalid");
            }
            if (n < 1) {
                throw new Error("input number less than 1");
            }
            if (Math.round(n) !== n) {
                throw new Error("input number not an integer");
            }
            return n;
        }
        function getConfValues() {
            return {
                r: assertZahlen(document.querySelector("#r").value || 13),
                s: assertZahlen(document.querySelector("#s").value || 4),
                h: assertZahlen(document.querySelector("#h").value || 5),
            }
        }
        function calculate(out) {
            const {r, s, h} = getConfValues();
            const d = s * r;
            if (! (h <= r)) {
                throw new Error("h < r");
            }
            if (! (r <= d)) {
                throw new Error("h < r");
            };
            const k = r + 2 - h;
            out.innerText = "Results:";
            Object.entries(definitions).map(ent => [ent[0], ent[1](d, h, s, r, k)]).toSorted((a, b)=>a[1] - b[1]).forEach(ent => {
                console.log("calculating " + ent[0]);
                out.innerText += `\n${ent[0]} = ${ent[1]}`;
            });
        }
        const inputCallback = async ()=>{
            const out = document.querySelector("#output");
            out.innerText = "calculating...";
            await asyncsleep(1000 / 60);
            try {
                const start = performance.now();
                calculate(out);
                bg.innerText = bg.innerText.split("completed in")[0] + `completed in ${(performance.now() - start).toFixed(2)}ms`;
            } catch(e) {
                out.innerText = e.toString();
                console.error(e);
            }
        };
        addEventListener("input", inputCallback);
        inputCallback();
    </script>
</body>
</html>